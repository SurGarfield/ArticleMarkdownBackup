# Article Markdown Backup Plugin

这是一个typecho备份插件，主要功能是备份和恢复文章，以及将文章转换为 Markdown 格式。
（注意：开发环境只有20篇文章用作测试以及博主的200篇文章进行测试，未测试更多文章的场景备份，可能含有未知bug，请注意及时备份数据库）

## 安装
1. 下载插件
2. 打开 Typecho 根目录
3. 解压至 ./usr/plugins/
4. 将目录重命名为`ArticleMarkdownBackup`

## 功能特性

1. **文章备份** - 备份所有文章和评论数据到JSON文件
2. **文章恢复** - 从备份文件恢复文章和评论数据
3. **格式转换** - 将HTML格式的文章转换为Markdown格式
4. **文件管理** - 支持上传备份文件和选择服务器备份文件

## 使用说明

### 备份功能
- 点击"备份所有文章"按钮可备份当前所有文章和评论
- 备份文件保存在插件目录的`backups`文件夹中
- 文件名格式：`AMD_backup_YYYYMMDD_XX.json`

### 恢复功能
- 选择备份文件后点击"恢复"按钮可恢复数据
- 如果不选择文件，默认使用最新的备份文件
- 支持上传本地备份文件

### Markdown转换
- 点击"全部转为MD格式"可将HTML格式的文章转换为Markdown
- 转换后的文章会添加`<!--markdown-->`标记
- 转换过程不可逆，请谨慎操作（转换前有弹窗提醒）

## 注意事项

1. 转换功能仅对包含HTML标签且未标记为Markdown的文章生效
2. 备份文件包含文章和评论的所有数据
3. 恢复操作会覆盖现有数据，请谨慎操作
4. 插件会在插件目录自动创建`backups`文件夹用于存储备份文件

## 技术说明

- 使用Typecho原生数据库接口进行数据操作
- HTML到Markdown转换采用正则表达式实现
- 理论上支持Typecho 1.2及以上版本（基于1.3版本开发）


-------------

# 新增内容

## 1.文章Cid管理策略（默认关闭）
- 进入后台 → 插件 → “Article Markdown Backup”插件 → 设置
- 在“策略管理”中选择“开启”，并在“CID 连贯策略”中选择一种策略
- 保存配置后生效；未开启时，不会对文章写入/发布产生影响

## 2.CID 管理页状态
- 后台菜单 → 控制台 → 扩展 → CID策略管理（或文章备份与转换页右侧切换到“CID 连贯管理”）
- 页面会显示：策略是否生效、当前策略、目前最大的CID、建议下一个CID、所有CID使用数、附件管理、调试日志
- 刷新日志按钮左侧会提示“策略已生效/未生效”

## 3.策略说明（四选一）
- 按最小可用位（跳过附件）`skip`：为新内容选择从1开始的最小未被有效内容或附件占用的CID；发现附件仅跳过不删除
- 按最小可用位（忽略附件，遇附件则删除）`ignore`：同上，但若最小可用位被附件占用，会删除该附件后使用该CID
- 按新增可用位（从现有最大CID开始）`grow_skip`：为新内容分配从“最大有效CID + 1”起连续递增的CID；发现附件仅跳过不删除
- 按新增可用位（忽略附件，遇附件则删除）`grow_ignore`：同上，但遇附件占位会删除附件后使用该CID

## 4.注意事项
- **如果你不知道这个cid策略是干什么的请不要使用**
- 未开启“策略管理”时，所有策略逻辑均不生效
- 选择 `ignore/grow_ignore` 会删除附件以释放CID，占位清理不可恢复，请先备份
